<hr />

<p>title: Some Ruby &amp; Rails Tricks
date: 27/08/2008</p>

<p>I certainly can&#8217;t claim to have <em>discovered</em> these tips; but they&#8217;ve been pretty helpful to me. Maybe this will just make them a little easier to find for whoever is looking for them next.</p>

<h3>Getting A Collection&#8217;s Index From Within a Partial</h3>


<p>Lets say you&#8217;re passing a collection to a partial, but that somewhere in that partial you are interested in knowing which index you&#8217;re at. Do you need to implement a counter? Nope; there already is one. A collection passed to a partial implicitly creates a counter called <code>[partial_name]_counter</code>. So, if you called with</p>

<pre>
<code class="ruby">
< %= render :partial => 'thing', :collection => @a_few_of_my_favorite_things %>
</code>
</pre>


<p>then in your partial, you could use:</p>

<pre>
<code class="ruby">
< %= thing_counter %>
</code>
</pre>


<p>to return the index as you plow through the collection. Life is good. Rails is looking out for you. (Hat tip to <a href="http://gmarik.blogspot.com/2007/09/rails-collection-index-within-partial.html">GMarik</a>, which is where I saw this one.)</p>

<h3>Obtaining a Class name From a String</h3>


<p>Today I found myself wanting to take a string, let&#8217;s say <code>"Thing"</code>, and use it as a class name, <code>Thing</code>. Again, it turns out this can be done. In Ruby, class names are constants, so you can do</p>

<pre>
<code class="ruby">
str = "Thing" #=> "Thing"
Kernel.const_get(str) #=> Thing
</code>
</pre>


<p>Hooray!</p>

<h3>Make Finding Easier</h3>


<p>Find yourself writing long, complicated find expressions in your code? There is a better way.</p>

<p>Perhaps in your code&#8230; maybe even in a view&#8230; maybe you want to find all <code>Things</code> that don&#8217;t belong to the current use, and which are flagged with some property, and you&#8217;re temped to write something like:</p>

<pre>
<code class="ruby">
Thing.find(:all, :conditions => ["user != ? and flag = true", current_user])
</code>
</pre>


<p>What we could do is put some <code>has_finder</code>s in the Thing model, something like</p>

<pre>
<code class="ruby">
class Thing < ActiveRecord::Base
has_finder :exclude_user, lambda {|user| {:conditions => "things.user_id != #{user.id}"}
has_finder :with_flag, :conditions => "things.flag = true"
</code>
</pre>


<p>Having done that, you could now replace that first bit with:</p>

<pre>
<code class="ruby">
Thing.find(:all).with_flag.exclude_user(current_user)
</code>
</pre>


<p>It&#8217;s a little shorter, sure, but more importantly, when you read it, it just makes more sense. A completely new person coming to look at this line would have a good idea what it was doing without even looking in the model to see what the <code>has_finder</code>s were doing.</p>

<h3>Okay then</h3>


<p>If you&#8217;ve spent any amount of time using rails, these probably aren&#8217;t new to you. Everything&#8217;s new at least <em>once</em>, though, so hopefully these are helpful to someone.</p>

<p>Other favorite ruby or rails tricks? Leave a comment! Heck, we&#8217;re not prejudiced, here, go ahead and comment with your favorite Python or Perl or [other language] tricks, too, if you like.</p>
